<%_ if(local.users.length > 0) { _%>
<div class="pure-u-1 is-center">
    <h2 class="content-head is-center"><%_ if(local.url.indexOf('/recover') < 0) { _%>Manage<%_ } else { _%>Recover<% } %> Users</h2>
    <p><%- include ./adminNav %></p>
    <p><%- include ./adminPaging %></p>
</div>
<table class="pure-table">
    <thead>
        <tr>
            <th>Email</th>
            <th>Status</th>
            <th style="width:40%">Token</th>
            <th> <%_ if(local.url.indexOf('/recover') < 0) { _%>Token Expires<%_ } else { _%>Deleted<% } %></th>
            <th>Created</th>
            <th>Modified</th>
        </tr>
        <tr>
            <th>
                <form class="pure-form is-center" onsubmit="filter('email'); return false;">
                    <input class="pure-input" type="text" placeholder="filter" id="filter-email" name="filter[email]">
                </form>
            </th>
            <th>                
                <form class="pure-form is-center" >
                    <select class="pure-input" id="filter-status" name="filter[status]" onchange="filter('status'); return false;">
                        <option value="*">All</option>
                        <option value="">Enabled</option>
                        <option value="null">Disabled</option>
                        <option value="active">Active</option>
                        <option value="invite-only">Invite New Users</option>
                        <option value="manage-users">Manage Users</option>
                    </select>
                </form>
            </th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
    </thead>
    <tbody>
      <%_ for(var i=0; i<local.users.length; i++) { _%>
        <tr id="<%- local.users[i].dataValues.id _%>">
            <td>
              <%_ if(local.users[i].dataValues.deletedAt == null) { _%>
                <a title="Impersonate <%- local.users[i].dataValues.email -%>" href="/dash/admin/user/<%= local.users[i].dataValues.id %>"><%- local.users[i].dataValues.email -%></a>
              <%_ } else { _%>
                <%- local.users[i].dataValues.email -%>
              <%_ } _%>
            </td>
            <td>
                <form class="pure-form is-center">
                    <select class="pure-input-1" id="status-<%= local.users[i].dataValues.id %>" name="status" <%_ if(local.users[i].dataValues.deletedAt == null) { _%>onchange="updateStatusById('<%= local.users[i].dataValues.id %>',document.querySelector('#status-<%= local.users[i].dataValues.id %>').value);"<% } else { %> disabled="disabled"<% }%>>
                        <option value=""<%_ if(!local.users[i].dataValues.status || local.users[i].dataValues.status == '' ) { _%>selected="true"<%_ } _%>>Disabled</option>
                        <option value="active" <%_ if(local.users[i].dataValues.status == 'active') { _%>selected="true"<%_ } _%>>Active</option>
                        <option value="invite-only" <%_ if(local.users[i].dataValues.status == 'invite-only') { _%>selected="true"<%_ } _%>>Invite New Users</option>
                        <option value="manage-users" <%_ if(local.users[i].dataValues.status == 'manage-users') { _%>selected="true"<%_ } _%>>Manage Users</option>
                    </select>
                </form>
            </td>
            <td>
                <form class="pure-form is-center">
                    <input class="pure-input-1" type="text" onclick="this.select()" name="token" readonly="true" value="<%= local.users[i].dataValues.token %>">
                </form>
            </td>
            <td>
              <%_ if(local.users[i].dataValues.deletedAt == null) { _%>
                <span class="<%_ if(new Date(local.users[i].dataValues.expires).getTime() < new Date().getTime()) { _%>red<%_ } _%>"><%= new Date(local.users[i].dataValues.expires).toISOString().slice(0, 19).replace('T', ' ') %>
                <form class="pure-form">
                    <button class="pure-button" title="Expire Token" onclick="expireById('<%= local.users[i].dataValues.id %>'); return false;"><i class="fa fa-remove"></i></button>
                </form>
              <%_ } else { _%>
                <span><%= new Date(local.users[i].dataValues.deletedAt).toISOString().slice(0, 19).replace('T', ' ') %>
                <form class="pure-form">
                    <button class="pure-button" title="Recover User" onclick="recoverById('<%= local.users[i].dataValues.id %>'); return false;"><i class="fa fa-undo"></i></button>
                </form>
              <%_ } _%>
            </td>
            <td>
                <%= new Date(local.users[i].dataValues.createdAt).toISOString().slice(0, 19).replace('T', ' ') _%>
              <%_ if(local.users[i].dataValues.deletedAt == null) { _%>
                <form class="pure-form">
                    <button class="pure-button" title="Delete User" onclick="deleteById('<%= local.users[i].dataValues.id %>'); return false;"><i class="fa fa-minus"></i></button>
                </form>
              <%_ } _%>
            </td>
            <td>
                <%= new Date(local.users[i].dataValues.updatedAt).toISOString().slice(0, 19).replace('T', ' ') _%>
              <%_ if(local.users[i].dataValues.deletedAt == null) { _%>
                <form class="pure-form"><button class="pure-button" title="Save" onclick="updateStatusById('<%= local.users[i].dataValues.id %>',document.querySelector('#status-<%= local.users[i].dataValues.id %>').value); return false;"><i class="fa fa-save"></i></button></form>
              <%_ } _%>
            </td>
        <tr>
      <%_ } _%> 
    </tbody>
</table>
<div class="pure-u-1 is-center">
    <p>
        <%- include ./adminPaging %>
    </p>
</div>
<big>&nbsp;</big>
<script>
  // eff jQuery
  let next = document.querySelectorAll(".next");
  if(next && next.length > 0){
    next[0].setAttribute('href', next[0].getAttribute('href') + window.location.search + window.location.hash);
    next[1].setAttribute('href', next[1].getAttribute('href') + window.location.search + window.location.hash);
  }
  let prev = document.querySelectorAll(".prev");
  if(prev && prev.length > 0){
    prev[0].setAttribute('href', prev[0].getAttribute('href') + window.location.search + window.location.hash);
    prev[1].setAttribute('href', prev[1].getAttribute('href') + window.location.search + window.location.hash);
  }
  if(location.search){
    document.getElementById('filter-clear').removeAttribute('style');
    var q = getQuery();
    let filter = 'filter[email]';
    if (filter in q){
      document.getElementById('filter-email').value = q[filter];
    }
    filter = 'filter[status]';
    if (filter in q){
      document.getElementById('filter-status').value = q[filter];
    }
  }
</script>
<%_ }else { _%>
<div class="pure-u-1 is-center" id="manage">
    <p><button class="pure-button" id="filter-clear" onclick="filter()">Clear Filters</button></p>
    <h2 class="content-head is-center">No results<br><br><br><br></h2>
</div>
<%_ } _%>